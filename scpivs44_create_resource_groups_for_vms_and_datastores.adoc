---
sidebar: sidebar 
permalink: scpivs44_create_resource_groups_for_vms_and_datastores.html 
keywords:  
summary: リソースグループは、保護するVM、データストア、vSphereタグ、およびvSphere VMフォルダのコンテナです。 
---
= リソースグループを作成する
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
リソースグループは、保護するVM、データストア、vSphereタグ、およびvSphere VMフォルダのコンテナです。

リソースグループには次のものを含めることができます。

* 従来の VM とデータストア
+
従来の VM 、従来の SAN データストア、従来の NAS データストアを任意に組み合わせて使用できます。従来の VM を VVol VM と組み合わせることはできません。

* FlexGroup データストア
+
単一のFlexGroup データストア。FlexGroup データストアのスパニングはサポートされていません。FlexGroup データストアを従来のVMまたはデータストアと組み合わせることはできません。

* FlexVol データストア
+
1 つ以上の FlexVol データストア。スパニングデータストアがサポートされている。

* VVol VM
+
1 つ以上の VVol VM が必要です。VVol VM を従来の VM またはデータストアと組み合わせることはできません。

* vSphereタグ
+
指定したvSphereタグが設定されたすべてのVMとデータストア（VVolデータストアを除く）。

* フォルダ内の VVol VM
+
1 つの指定した vVol フォルダにすべての vVol が含まれています。フォルダに VVol VM と従来の VM が混在している場合、 SnapCenter Plug-in for VMware vSphere は VVol VM をバックアップし、従来の VM はスキップします。



すべてのリソースグループ：


IMPORTANT: VMware vSphere Cluster Service （ vCLS ）を使用している場合は、 vCLS によって管理される VM を SnapCenter VMware プラグインのリソースグループに含めないでください。


TIP: SnapCenter Plug-in for VMware vSphere 4.5 以降では、 ASA アグリゲートで最大 128TB の大容量 LUN サイズのデータストアがサポートされます。大規模なLUNを保護する場合は、レイテンシを回避するためにシックプロビジョニングされたLUNのみを使用します。


IMPORTANT: アクセスできない状態の VM は追加しないでください。アクセスできない VM を含むリソースグループを作成することは可能ですが、そのリソースグループのバックアップは失敗します。

.作業を開始する前に
VVOL VMを含むリソースグループを作成する前に、VMware用のONTAP ツールを導入しておく必要があります。

詳細については、を参照してください https://docs.netapp.com/us-en/ontap-tools-vmware-vsphere/index.html["VMware vSphere 用の ONTAP ツール"^]。

.このタスクについて
リソースグループに対しては、いつでもリソースを追加または削除できます。

* 単一リソースのバックアップ
+
単一のリソース（単一の VM など）をバックアップするには、その単一のリソースを含むリソースグループを作成する必要があります。

* 複数のリソースのバックアップ
+
複数のリソースをバックアップするには、複数のリソースを含むリソースグループを作成する必要があります。

* MetroCluster 環境で FlexGroup ボリュームを含むリソースグループ
+
ONTAP 9.8 または ONTAP 9.9 で実行している場合は、スイッチオーバーまたはスイッチバック後に、 MetroCluster SnapCenter プラグインサービスを再起動し、 SnapMirror 関係を再同期してから、 環境でリソースグループをバックアップする必要があります。

+
ONTAP 9.8 では、スイッチバック後にバックアップがハングします。この問題は、 ONTAP 9.9 で修正されています。

* Snapshot コピーの最適化
+
Snapshot コピーを最適化するには、同じボリュームに関連付けられている VM とデータストアを 1 つのリソースグループにグループ化します。

* バックアップポリシー
+
リソースグループはバックアップポリシーなしで作成できますが、データ保護処理はリソースグループに少なくとも1つのポリシーが適用されている場合にのみ実行できます。リソースグループの作成プロセスで、既存のポリシーを使用するか、新しいポリシーを作成できます。

+

NOTE: Snapshotロック期間が設定されたバックアップポリシーを選択する場合は、ONTAP 9.12.1以降のバージョンを選択する必要があります。



* 互換性チェック
+
リソースグループを作成すると、 SnapCenter によって互換性チェックが実行されます。

+
<<互換性チェックの失敗を管理します>>



.手順
. SCVプラグインの左側ナビゲータペインで、*[リソースグループ]*をクリックし、*[作成]*を選択してウィザードを開始します。


リソースグループを作成するには、この方法が最も簡単です。ただし、次のいずれかを実行して、 1 つのリソースで構成されるリソースグループを作成することもできます。

* 1つのVMのリソースグループを作成するには、*[メニュー]*>*[ホストおよびクラスタ]*をクリックし、VMを右クリックしてNetApp SnapCenterを選択し、*[リソースグループの作成]*を選択します。
* 1つのデータストアのリソースグループを作成するには、*[メニュー]*>*[ホストおよびクラスタ]*をクリックし、データストアを右クリックして*[ NetApp SnapCenter ]*を選択し、*[リソースグループの作成]*を選択します。
+
.. ウィザードの [ 一般情報と通知 *] ページで、次の操作を行います。
+
|===
| フィールド名 | 操作 


| vCenter Server の各サービスを提供 | vCenter サーバを選択します。 


| 名前 | リソースグループの名前を入力します。VM 、データストア、ポリシー、バックアップ、リソースグループの名前には、次の特殊文字は使用できません： %&*$#@ ！\ / ： * ？"<> - [ 垂直バー ] ； ' 、アンダースコア文字（ _ ）を使用できます。特殊文字を含む VM またはデータストアの名前は切り捨てられるため、特定のバックアップを検索することが難しくなります。リンクモードでは、各 vCenter に個別の SnapCenter VMware プラグインリポジトリがあります。そのため、 vCenter 間で名前の重複を使用できます。 


| 説明 | リソースグループの概要を入力します。 


| 通知 | このリソースグループ上の処理に関する通知を受信する場合に選択します。エラーまたは警告：エラーおよび警告のみの通知を送信：エラーのみの通知を送信：すべてのメッセージタイプの通知を送信しない：通知を送信しません 


| E メールの送信元 | 通知の送信元となる E メールアドレスを入力します。 


| E メールの送信先 | 通知の受信者の E メールアドレスを入力します。受信者が複数いる場合は、 E メールアドレスをカンマで区切ります。 


| E メールの件名 | 通知 E メールの件名を入力します。 


| 最新の Snapshot 名  a| 
最新の Snapshot コピーに「 _recent 」というサフィックスを追加する場合は、このチェックボックスをオンにします。「 _recent 」サフィックスは、日付とタイムスタンプを置き換えます。


NOTE: リソース・グループに適用される各ポリシーに対して'_recentのバックアップが作成されますしたがって'複数のポリシーを持つリソース・グループには'複数の最新のバックアップが含まれます手動で'_rerecentのバックアップ名を変更しないでください



| カスタム Snapshot 形式  a| 
Snapshot コピー名にカスタム形式を使用する場合は、このチェックボックスをオンにして名前の形式を入力します。

*** デフォルトでは、この機能は無効になっています。
*** デフォルトの Snapshot コピー名には、「 <resourcegroup>_ <Date-timestamp> 」という形式が使用されますが、変数 $resourcegroup 、 $Policy 、 $hostname 、 $scheduleType 、および $CustomText を使用してカスタム形式を指定できます。カスタム名フィールドのドロップダウンリストを使用して、使用する変数とその使用順序を選択します。$CustomText を選択した場合、名前の形式は「 <CustomName>_ <Date-timestamp> 」です。表示される追加のボックスにカスタムテキストを入力します。注意：「 _recent 」サフィックスも選択する場合、カスタム Snapshot 名がデータストア内で一意になるようにする必要があります。したがって、名前に $resourcegroup 変数と $Policy 変数を追加する必要があります。
*** 名前に特殊文字が含まれている場合は、 Name フィールドと同じガイドラインに従ってください。


|===
.. [* リソース *] ページで、次の操作を実行します。
+
|===
| フィールド名 | 操作 


| 適用範囲 | 保護するリソースのタイプを選択します。
*データストア（1つ以上の指定されたデータストア内のすべての従来のVM）。VVOLデータストアは選択できません。
*仮想マシン（従来のVMまたはVVol VMを個別に移動。フィールドでは、VMまたはVVol VMを含むデータストアに移動する必要があります）。
FlexGroup データストア内のVMを個別に選択することはできません。
*タグ
タグベースのデータストア保護は、NFSデータストアとVMFSデータストア、および仮想マシンとVVOL仮想マシンでのみサポートされます。
* VMフォルダ（指定したフォルダ内のすべてのVVol VM。ポップアップフィールドでフォルダが配置されているデータセンターに移動する必要があります） 


| データセンター | 追加する VM またはデータストアまたはフォルダに移動します。 


| 使用可能なエンティティ | 保護するリソースを選択し、 * > * をクリックして選択した項目を選択したエンティティリストに移動します。 
|===
+
[ 次へ ] をクリックすると、システムはまず SnapCenter が管理していることを確認し、選択したリソースがあるストレージと互換性があることを確認します。

+
「 Selected <resource-key > is not SnapCenter compatible 」というメッセージが表示される場合、選択したリソースは SnapCenter と互換性がありません。を参照してください <<互換性チェックの失敗を管理します>> を参照してください。

+
バックアップから1つ以上のデータストアをグローバルに除外するには、構成ファイル「scbr.override」の「global.DS.exclude.pattern」プロパティでデータストア名を指定する必要があります。を参照してください <<scpivs44_properties_you_can_override.adoc#Properties you can override,オーバーライドできるプロパティ>>。

.. [ * スパニングディスク * ] ページで、複数のデータストアに複数の VMDK がある VM のオプションを選択します。
+
*** Always exclude all spanning datastores（データストアのデフォルト）
*** すべてのスパニングデータストアを常に含める（VMのデフォルト）
*** 対象に含めるスパニングデータストアを手動で選択します
+
FlexGroup データストアと VVOL データストアにスパニング VM を使用することはできません。



.. [* Policies] ページで、次の表に示すように 1 つ以上のバックアップポリシーを選択または作成します。
+
|===
| を使用するには ... | 操作 


| 既存のポリシー | リストから 1 つ以上のポリシーを選択します。 


| 新しいポリシー  a| 
... 「 * Create * 」を選択します。
... 新しいバックアップポリシーの作成ウィザードに戻るには、新しいバックアップポリシーの作成ウィザードを完了します。


|===
+
リンクモードでは、リンクされたすべての vCenter のポリシーがリストに表示されます。リソースグループと同じ vCenter 上にあるポリシーを選択する必要があります。

.. [* Schedules* ] ページで、選択した各ポリシーのバックアップスケジュールを設定します。
+
image:scpivs44_image18.png["[リソースグループの作成]ウィンドウ"]

+
開始時間フィールドに、 0 以外の日時を入力します。日付は「日 / 月 / 年」の形式で指定する必要があります。

+
「各 * 」フィールドで日数を選択すると、その月の 1 日目にバックアップが実行され、そのあとは指定した間隔でバックアップが実行されます。たとえば、オプション「 * Every 2 days * 」を選択すると、開始日が偶数か奇数かに関係なく、 1 日目、 3 日目、 5 日目、 7 日目などの月全体にバックアップが実行されます。

+
各フィールドに入力する必要があります。SnapCenter VMware プラグインは、 SnapCenter VMware プラグインが導入されているタイムゾーンでスケジュールを作成します。タイムゾーンは、 SnapCenter Plug-in for VMware vSphere GUI を使用して変更できます。

+
link:scpivs44_modify_the_time_zones.html["バックアップのタイムゾーンを変更します"]。

.. 概要を確認し、 [ 完了 ] をクリックします。
+
「 * 完了」をクリックする前に、ウィザードの任意のページに戻って情報を変更できます。

+
[ 完了 ] をクリックすると ' 新しいリソースグループがリソースグループリストに追加されます

+

NOTE: バックアップ内のいずれかの VM で休止処理が失敗すると、選択したポリシーで VM の整合性が選択されていても、バックアップは Not VM-Consistent とマークされます。この場合、一部の VM が正常に休止された可能性があります。







== 互換性チェックの失敗を管理します

リソースグループを作成する際に、 SnapCenter で互換性チェックが実行されます。

非互換性の理由は次のとおりです。

* サポート対象外のストレージ上に VMDK がある： 7-Mode で実行されている ONTAP システムや ONTAP 以外のデバイスなど。
* データストアは、 clustered Data ONTAP 8.2.1 以前を実行しているネットアップストレージにあります。
+
SnapCenter バージョン 4.x では、 ONTAP 8.3.1 以降がサポートされます。

+
SnapCenter Plug-in for VMware vSphere では、すべての ONTAP バージョンの互換性チェックは実行されません。 ONTAP バージョン 8.2.1 以前にのみ実行されます。したがって、を常に参照してください https://imt.netapp.com/matrix/imt.jsp?components=112310;&solution=1517&isHWU&src=IMT["ネットアップの Interoperability Matrix Tool （ IMT ）"^] SnapCenter サポートの最新情報については、を参照してください。

* 共有 PCI デバイスが VM に接続されている。
* 優先 IP は SnapCenter で設定されていません。
* Storage VM （ SVM ）の管理 IP を SnapCenter に追加していません。
* Storage VM は停止しています。


互換性エラーを修正するには、次の手順に従います。

. Storage VM が実行されていることを確認してください。
. VM が配置されているストレージシステムが SnapCenter Plug-in for VMware vSphere インベントリに追加されていることを確認します。
. Storage VM が SnapCenter に追加されていることを確認してください。VMware vSphere ClientのGUIで、Add storage systemオプションを使用します。
. ネットアップデータストアとネットアップ以外のデータストアの両方に VMDK がある複数の VM がまたがっている場合は、 VMDK をネットアップデータストアに移動します。

